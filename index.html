<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>pnevma</title>
<style>
  body {
    background: #111;
    color: #fff;
    font-family: sans-serif;
    text-align: center;
    user-select: none;
  }
  #car-name { font-size: 24px; margin: 10px; }
  #scene { position: relative; height: 220px; margin-bottom: 20px; }
  #ground { position: absolute; bottom: 40px; left: 0; width: 100%; height: 4px; background: #444; }
  #car {
    position: absolute;
    bottom: 40px;
    left: 50%;
    width: 300px;
    height: 120px;
    transform: translateX(-50%) translateY(0);
    transition: transform 0.15s ease-out;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
  }
  #idle-warning { position: absolute; top: -30px; left: 50%; transform: translateX(-50%); font-size: 18px; color: orange; display: none; animation: blink 1s infinite; }
  @keyframes blink { 0%,50%,100% { opacity: 1; } 25%,75% { opacity: 0; } }
  #boost-warning { position:absolute;top:-50px;left:50%;transform:translateX(-50%);color:#ff0;font-size:20px;display:none; }
  #pressure { font-size: 22px; margin: 10px; }
  #bar { width: 80%; height: 20px; background: #333; margin: 10px auto; position: relative; }
  #fill { height: 100%; width: 0%; background: lime; transition: width 0.1s, background 0.2s; }
  #tap, #china { padding: 15px 30px; font-size: 18px; margin: 10px; }
</style>
</head>
<body>

<div id="car-name"></div>

<div id="scene">
  <div id="ground"></div>
  <div id="car"></div>
  <div id="idle-warning">‚ö† Idle</div>
  <div id="boost-warning"></div>
</div>

<div id="pressure">–î–∞–≤–ª–µ–Ω–∏–µ: 0</div>

<div id="bar">
  <div id="fill"></div>
</div>

<button id="tap">–¢–∞–ø–∞—Ç—å üí®</button>
<button id="china">–ö–∏—Ç–∞–π—Å–∫–∏–µ –±–∞–ª–ª–æ–Ω—ã üá®üá≥ (1 —Ä–∞–∑)</button>

<script>
// ====== DATA ======
const cars = [
  { name:"Mercedes W220", img:"images/w220.png", maxPressure:100, explosionChance:0.02 },
  { name:"Audi A8", img:"images/a8.png", maxPressure:110, explosionChance:0.04 }
];

let round=0, pressure=0, saved=false;
let currentCar={...cars[round]};
let lastTapTime=Date.now(), boostedTapsLeft=0, pendingExplosionMultiplier=1;
let mainInflatedOnce=false;
let lastTapTimestamp=0;
let tapIntervals=[];

// ====== ELEMENTS ======
const carNameEl = document.getElementById("car-name");
const carEl = document.getElementById("car");
const pressureEl = document.getElementById("pressure");
const fillEl = document.getElementById("fill");
const idleEl = document.getElementById("idle-warning");
const boostEl = document.getElementById("boost-warning");

function pressureToHeight(p){ return Math.min(p/currentCar.maxPressure*120,120); }

function updateUI(){
  carNameEl.textContent = currentCar.name;
  pressureEl.textContent = `–î–∞–≤–ª–µ–Ω–∏–µ: ${pressure}`;
  fillEl.style.width = Math.min(pressure/currentCar.maxPressure*100,100)+"%";
  if(pressure<currentCar.maxPressure*0.6) fillEl.style.background="lime";
  else if(pressure<currentCar.maxPressure*0.9) fillEl.style.background="yellow";
  else fillEl.style.background="red";
  const y=-pressureToHeight(pressure);
  carEl.style.transform=`translateX(-50%) translateY(${y}px)`;
}

function explode(){
  alert("üí• –ë–∞–ª–ª–æ–Ω—ã —Ä–≤–∞–Ω—É–ª–∏!");
  fillEl.style.background="white";
  setTimeout(()=>updateUI(),200);
  if(saved){ alert("–ö–∏—Ç–∞–π—Å–∫–∏–µ –±–∞–ª–ª–æ–Ω—ã —Å–ø–∞—Å–ª–∏ üò¨"); saved=false; pressure=Math.floor(currentCar.maxPressure*0.5);}
  else{ round=0; pressure=0; mainInflatedOnce=false; currentCar={...cars[round]}; carEl.style.backgroundImage=`url(${currentCar.img})`; tapIntervals=[]; }
}

// ====== –ø–ª–∞–≤–Ω—ã–π —Å–ø—É—Å–∫ –¥–∞–≤–ª–µ–Ω–∏—è ======
setInterval(()=>{
  const idleSeconds=(Date.now()-lastTapTime)/1000;
  idleEl.style.display=(idleSeconds>=5)?"block":"none";
  let decay=0;
  if(idleSeconds>=10) decay=2;
  else if(idleSeconds>=5) decay=1;
  if(decay>0){ pressure=Math.max(0,pressure-decay); updateUI(); }
},1000);

// ====== TAP ======
document.getElementById("tap").onclick=()=>{
  const now=Date.now();
  const interval = now - lastTapTimestamp;
  lastTapTimestamp = now;
  tapIntervals.push(interval);
  if(tapIntervals.length>3) tapIntervals.shift();

  const idleSeconds=Math.floor((now-lastTapTime)/1000);
  lastTapTime=now;

  // boost warning –ø–æ—Å–ª–µ –ø—Ä–æ—Å—Ç–æ—è
  if(idleSeconds>=10){ pendingExplosionMultiplier=2.5; boostedTapsLeft=2; boostEl.textContent="x2.5"; boostEl.style.display="block"; setTimeout(()=>boostEl.style.display="none",800);}
  else if(idleSeconds>=5){ pendingExplosionMultiplier=1.5; boostedTapsLeft=2; boostEl.textContent="x1.5"; boostEl.style.display="block"; setTimeout(()=>boostEl.style.display="none",800); }

  // –±–∞–∑–æ–≤—ã–π —à–∞–Ω—Å –≤–∑—Ä—ã–≤–∞
  let explosionChance=currentCar.explosionChance;

  // –ø–æ–≤—ã—à–∞–µ–º —à–∞–Ω—Å –ø—Ä–∏ —á–∞—Å—Ç–æ–º —Ç–∞–ø–µ
  const avgInterval = tapIntervals.reduce((a,b)=>a+b,0)/tapIntervals.length;
  if(avgInterval < 300) explosionChance *= 2;
  else if(avgInterval < 500) explosionChance *= 1.5;

  // boost –ø–æ—Å–ª–µ –ø—Ä–æ—Å—Ç–æ—è
  if(boostedTapsLeft>0){ explosionChance *= pendingExplosionMultiplier; boostedTapsLeft--; if(boostedTapsLeft===0) pendingExplosionMultiplier=1; }

  // –¥–æ–±–∞–≤–ª—è–µ–º –¥–∞–≤–ª–µ–Ω–∏–µ
  pressure += Math.floor(Math.random()*5)+3;

  // –ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ –º–∞—à–∏–Ω–∫–∏
  carEl.style.transition = "transform 0.1s ease-out";
  const y=-pressureToHeight(pressure)-15;
  carEl.style.transform=`translateX(-50%) translateY(${y}px)`;
  setTimeout(()=>updateUI(),100);

  // –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑—Ä—ã–≤–∞
  if(Math.random() < explosionChance || pressure>currentCar.maxPressure*1.05){ explode(); updateUI(); return; }

  // –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è
  if(pressure >= currentCar.maxPressure){
    mainInflatedOnce = true;
    alert("‚úÖ –ú–∞—à–∏–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞–∫–∞—á–∞–Ω–∞!");
    round++; if(round >= cars.length){ alert("üèÜ –í–µ—Å—å –ª—é–∫—Å –ø–æ–¥–Ω—è—Ç!"); round=0;}
    currentCar={...cars[round]}; pressure=0; carEl.style.backgroundImage=`url(${currentCar.img})`;
  }

  updateUI();
};

// ====== –ö–∏—Ç–∞–π—Å–∫–∏–µ –±–∞–ª–ª–æ–Ω—ã ======
document.getElementById("china").onclick=()=>{
  if(!mainInflatedOnce){ alert("‚ö† –°–Ω–∞—á–∞–ª–∞ –Ω–∞–∫–∞—á–∞–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –±–∞–ª–ª–æ–Ω—ã!"); return; }
  if(saved) return;
  saved=true; currentCar.explosionChance*=2;
  alert("–ü–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∏—Ç–∞–π—Å–∫–∏–µ –±–∞–ª–ª–æ–Ω—ã üò¨");
};

// ====== INIT ======
carEl.style.backgroundImage=`url(${currentCar.img})`;
updateUI();
</script>

</body>
</html>
